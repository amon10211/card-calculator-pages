<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- 防 HTML 快取 -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <title>算牌計算器</title>
  <link rel="icon" type="image/png" sizes="48x48" href="assets/icon.png">

  <!-- ✅ 改版只改這個（YYYYMMDD） -->
  <script>
    window.APP_VERSION = "20260117";
  </script>

  <!-- CSS（手機/桌機分離） -->
  <link rel="stylesheet" href="css/base.css?v=20260117" />
  <link rel="stylesheet" href="css/desktop.css?v=20260117" media="screen and (min-width:769px)" />
  <link rel="stylesheet" href="css/mobile.css?v=20260117" media="screen and (max-width:768px)" />
</head>

<body class="is-home">
  <!-- 首頁 -->
  <div class="home-overlay" id="homeOverlay">
    <div class="home-card">
      <div class="home-head">
        <h1 class="home-title">算牌計算器</h1>
        <p class="home-sub">快速輸入｜自動分析｜控注統計</p>
      </div>

      <div class="home-lines">
        <div class="home-item">
          <span class="home-dot cyan"></span>
          <div class="home-text">
            <div class="t">依序輸入 6 張牌（閒、閒、莊、莊、閒、莊）</div>
            <div class="d">無補牌直接按「不補牌」</div>
          </div>
        </div>

        <div class="home-item">
          <span class="home-dot gold"></span>
          <div class="home-text">
            <div class="t">輸入滿會自動分析：下注建議</div>
            <div class="d">點選「分析依據」可查看跑牌與矩陣細節</div>
          </div>
        </div>

        <div class="home-item">
          <span class="home-dot blue"></span>
          <div class="home-text">
            <div class="t">重置與統計說明</div>
            <div class="d">「重置」只清牌局，「重置統計」才會清命中紀錄</div>
          </div>
        </div>
      </div>

      <div class="home-actions">
        <label>
          <input type="checkbox" id="rememberSkip">
          下次略過首頁
        </label>
        <button class="home-btn" id="startBtn">開始 →</button>
      </div>

      <div class="home-tip">
        小提醒：按 <span class="kbd">Esc</span> 也可直接進入主畫面。
      </div>
    </div>
  </div>

  <!-- ✅ 結果面板（手機：第一層結論 + 第二層收合確認） -->
  <aside class="result-panel" id="resultPanel">
    <!-- 第一層：結論卡 -->
    <div class="bet-card" id="betCard">
      <div class="bet-main" id="betMain">建議：—</div>
      <div class="bet-sub" id="betSub">—</div>
      <div class="bet-advice" id="betAdvice">—</div>
      <div class="bet-light" id="betLight"></div>
    </div>

    <!-- 第二層：分析確認（預設收合） -->
    <details class="analysis" id="analysisDetails">
      <summary>
        <span class="sum-title">分析依據</span>
        <span class="sum-brief" id="analysisBrief">跑牌：—｜矩陣：—</span>
      </summary>

      <div class="analysis-body">
        <div class="analysis-row">
          <div class="k">跑牌結果</div>
          <div class="v" id="runLine">—</div>
        </div>

        <div class="analysis-row">
          <div class="k">矩陣結果</div>
          <div class="v" id="matrixLine">—</div>
        </div>

        <!--
        <div class="analysis-row">
          <div class="k">一致判斷</div>
          <div class="v" id="agreeLine">—</div>
        </div>
        -->

        <!-- 兼容：保留舊 id，避免既有程式找不到 -->
        <div class="info" id="runInfo" style="display:none"></div>
        <div class="info" id="matrixInfo" style="display:none"></div>
        <div class="result-line" id="runFinal" style="display:none">結果：—</div>
        <div class="result-line" id="matrixFinal" style="display:none">結果：—</div>
      </div>
    </details>
  </aside>

  <!-- 中：主操作 -->
  <main class="wrap" id="wrap">
    <div class="board">
      <div class="slot" id="s1"></div>
      <div class="slot" id="s2"></div>
      <div class="slot" id="s3"></div>
      <div class="slot" id="s4"></div>
    </div>

    <div class="board2">
      <div class="slot" id="s5"></div>
      <div class="slot" id="s6"></div>
    </div>

    <div class="btns" id="btns"></div>

    <!-- ✅ 第三層：操作列（底部固定） -->
    <div class="ops">
      <button id="noDrawBtn">不補牌</button>
      <button id="undoBtn">上一步</button>
      <button id="resetBtn">重置</button>
      <button id="menuBtn" aria-label="選單">☰</button>
    </div>
  </main>

  <!-- ✅ ☰ 選單：門檻 / 統計 / 回首頁 -->
  <div class="menu-overlay" id="menuOverlay" aria-hidden="true">
    <div class="menu-card" role="dialog" aria-modal="true" aria-label="設定與統計">
      <div class="menu-head">
        <div class="menu-title">設定 / 統計</div>
        <button class="menu-close" id="menuCloseBtn" aria-label="關閉">✕</button>
      </div>

        <div class="menu-stat">
          <div class="t">命中次數</div>
          <div class="n blue" id="hitCountMenu">0</div>
        </div>

        <div class="menu-meta" id="hitRateMenu">命中率：—</div>
        <div class="menu-meta" id="phaseMenu">盤況：—</div>

        <button class="reset-shared" id="resetStatsBtnMenu">重置統計</button>
      </div>

      <div class="menu-actions">
        <button id="goHomeBtnMenu">返回首頁</button>
      </div>
    </div>
  </div>

  <!-- 右：統計（桌機用；手機用 mobile.css 隱藏） -->
  <aside class="stats-right" id="statsRight">
    <div class="panel">
      <div class="panel-title">命中次數</div>
      <div class="panel-value blue" id="hitCount">0</div>
      <div class="rate" id="hitRate">命中率：—</div>
      <div class="phase" id="phase">盤況：—</div>

      <button class="reset-shared" id="resetStatsBtn">重置統計</button>
    </div>
  </aside>

  <!-- 首頁控制 -->
  <script>
    (function () {
      const KEY = "roadmind_skip_home_v1";
      const body = document.body;
      const startBtn = document.getElementById("startBtn");
      const rememberSkip = document.getElementById("rememberSkip");

      try {
        if (localStorage.getItem(KEY) === "1") {
          rememberSkip.checked = true;
          body.classList.remove("is-home");
        }
      } catch (e) {}

      startBtn.addEventListener("click", () => {
        try {
          localStorage.setItem(KEY, rememberSkip.checked ? "1" : "0");
        } catch (e) {}
        body.classList.remove("is-home");
      });

      window.addEventListener("keydown", (e) => {
        if (e.key === "Escape") body.classList.remove("is-home");
      });
    })();
  </script>

  <!-- ✅ iPhone/Safari 最穩：直接載入帶版本 main.js -->
  <script type="module">
    import "./js/main.js?v=20260117";
  </script>
</body>
</html>
