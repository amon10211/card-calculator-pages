<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- 防 HTML 快取 -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <title>算牌計算器</title>
  <link rel="icon" type="image/png" sizes="48x48" href="assets/icon.png">

  <!-- ✅ 改版只改這個（YYYYMMDD） -->
  <script>
    window.APP_VERSION = "20260115";
  </script>

  <!-- CSS（手機/桌機分離） -->
  <link rel="stylesheet" href="css/base.css?v=20260115" />
  <link rel="stylesheet" href="css/desktop.css?v=20260115" media="screen and (min-width:769px)" />
  <link rel="stylesheet" href="css/mobile.css?v=20260115" media="screen and (max-width:768px)" />
</head>

<body class="is-home">
  <!-- 首頁 -->
  <div class="home-overlay" id="homeOverlay">
    <div class="home-card">
      <div class="home-head">
        <h1 class="home-title">算牌計算器</h1>
        <p class="home-sub">快速輸入｜自動分析｜控注統計</p>
      </div>

      <div class="home-lines">
        <div class="home-item">
          <span class="home-dot cyan"></span>
          <div class="home-text">
            <div class="t">依序輸入 6 張牌（閒、閒、莊、莊、閒、莊）</div>
            <div class="d">無補牌就按 <span class="kbd cyan">不補牌</span> 補滿格子。</div>
          </div>
        </div>

        <div class="home-item">
          <span class="home-dot gold"></span>
          <div class="home-text">
            <div class="t">輸入滿會自動計算：跑牌值／矩陣／下注建議</div>
            <div class="d">下注建議含：一致門檻、信心星等、控注提示。</div>
          </div>
        </div>

        <div class="home-item">
          <span class="home-dot blue"></span>
          <div class="home-text">
            <div class="t">統計只算「真的下注」</div>
            <div class="d">命中率＋盤況（近 10 把）。</div>
          </div>
        </div>
      </div>

      <div class="home-actions">
        <label>
          <input type="checkbox" id="rememberSkip">
          下次略過首頁
        </label>
        <button class="home-btn" id="startBtn">開始 →</button>
      </div>

      <div class="home-tip">小提醒：按 <span class="kbd">Esc</span> 也可直接進入主畫面。</div>
    </div>
  </div>

  <!-- 左：結果 -->
  <aside class="result-panel" id="resultPanel">
    <div class="section-title run">【跑牌值】</div>
    <div class="info" id="runInfo"></div>
    <div class="result-line" id="runFinal">結果：—</div>

    <div class="divider"></div>

    <div class="section-title matrix">【矩陣】</div>
    <div class="info" id="matrixInfo"></div>
    <div class="result-line" id="matrixFinal">結果：—</div>

    <div class="divider"></div>

    <div class="bet-panel">
      <div class="betTextWrap">
        <div class="betText" id="betTextLabel">下注建議：</div>
        <div class="betMeta" id="betMeta">—</div>
      </div>
      <div class="bet-light" id="betLight"></div>
    </div>
  </aside>

  <!-- 中：主操作 -->
  <main class="wrap" id="wrap">
    <div class="board">
      <div class="slot" id="s1"></div>
      <div class="slot" id="s2"></div>
      <div class="slot" id="s3"></div>
      <div class="slot" id="s4"></div>
    </div>

    <div class="board2">
      <div class="slot" id="s5"></div>
      <div class="slot" id="s6"></div>
    </div>

    <div class="btns" id="btns"></div>

    <div class="ops">
      <button id="noDrawBtn">不補牌</button>
      <button id="undoBtn">上一步</button>
      <button id="resetBtn">重置</button>
      <button id="goHomeBtn">返回首頁</button>
    </div>
  </main>

  <!-- 右：統計 -->
  <aside class="stats-right" id="statsRight">
    <div class="panel">
      <div class="panel-title">已下注局數</div>
      <div class="panel-value cyan" id="betCount">0</div>
    </div>

    <div class="panel">
      <div class="panel-title">命中次數</div>
      <div class="panel-value blue" id="hitCount">0</div>
      <div class="rate" id="hitRate">命中率：—</div>
      <div class="phase" id="phase">盤況：—</div>

      <div class="phase" style="margin-top:8px;">
        門檻：
        <select id="thresholdSelect">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
        </select>
        把一致才下注
      </div>

      <button class="reset-shared" id="resetStatsBtn">重置統計</button>
    </div>
  </aside>

  <!-- 首頁控制 -->
  <script>
    (function(){
      const KEY = "roadmind_skip_home_v1";
      const body = document.body;
      const startBtn = document.getElementById("startBtn");
      const rememberSkip = document.getElementById("rememberSkip");

      try{
        if(localStorage.getItem(KEY) === "1"){
          rememberSkip.checked = true;
          body.classList.remove("is-home");
        }
      }catch(e){}

      startBtn.addEventListener("click", ()=>{
        try{ localStorage.setItem(KEY, rememberSkip.checked ? "1" : "0"); }catch(e){}
        body.classList.remove("is-home");
      });

      window.addEventListener("keydown", (e)=>{
        if(e.key === "Escape") body.classList.remove("is-home");
      });
    })();
  </script>

  <!-- ✅ iPhone/Safari 最穩：直接載入帶版本 main.js（不靠 importmap） -->
  <script type="module">
    import "./js/main.js?v=20260115";
  </script>
</body>
</html>
